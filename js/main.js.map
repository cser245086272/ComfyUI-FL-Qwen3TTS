{"version":3,"file":"main.js","sources":["../src/styles.ts","../src/TrainingWidget.ts","../src/main.ts"],"sourcesContent":["export const TRAINING_WIDGET_STYLES = `\r\n  .qwen3-training-widget {\r\n    background: #1a1a2e;\r\n    border-radius: 8px;\r\n    padding: 16px;\r\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n    color: #e0e0e0;\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  .qwen3-training-widget * {\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  .training-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: flex-start;\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  .status-panel {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 4px;\r\n    flex: 1;\r\n  }\r\n\r\n  .epoch-display, .loss-display {\r\n    font-size: 14px;\r\n    color: #a0a0a0;\r\n  }\r\n\r\n  .epoch-display span, .loss-display span {\r\n    color: #E93D82;\r\n    font-weight: bold;\r\n    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;\r\n  }\r\n\r\n  .status-text {\r\n    font-size: 12px;\r\n    color: #808080;\r\n    margin-top: 4px;\r\n  }\r\n\r\n  .stop-btn {\r\n    padding: 8px 16px;\r\n    background: transparent;\r\n    border: 1px solid #E93D82;\r\n    color: #E93D82;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    font-size: 12px;\r\n    font-weight: 500;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .stop-btn:hover:not(:disabled) {\r\n    background: rgba(233, 61, 130, 0.2);\r\n  }\r\n\r\n  .stop-btn:disabled {\r\n    opacity: 0.5;\r\n    cursor: not-allowed;\r\n    border-color: #666;\r\n    color: #666;\r\n  }\r\n\r\n  .progress-container {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  .progress-bar {\r\n    flex: 1;\r\n    height: 8px;\r\n    background: #2a2a4e;\r\n    border-radius: 4px;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .progress-fill {\r\n    height: 100%;\r\n    background: linear-gradient(90deg, #E93D82, #ff6b9d);\r\n    transition: width 0.3s ease;\r\n    border-radius: 4px;\r\n  }\r\n\r\n  .progress-text {\r\n    font-size: 12px;\r\n    color: #a0a0a0;\r\n    min-width: 40px;\r\n    text-align: right;\r\n    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;\r\n  }\r\n\r\n  .validation-section {\r\n    border-top: 1px solid #2a2a4e;\r\n    padding-top: 12px;\r\n  }\r\n\r\n  .section-title {\r\n    font-size: 11px;\r\n    color: #808080;\r\n    margin-bottom: 8px;\r\n    text-transform: uppercase;\r\n    letter-spacing: 1px;\r\n  }\r\n\r\n  .audio-timeline {\r\n    display: flex;\r\n    gap: 8px;\r\n    flex-wrap: wrap;\r\n    margin-bottom: 12px;\r\n    min-height: 32px;\r\n  }\r\n\r\n  .audio-timeline:empty::before {\r\n    content: 'Validation samples will appear here...';\r\n    color: #555;\r\n    font-size: 12px;\r\n    font-style: italic;\r\n  }\r\n\r\n  .timeline-chip {\r\n    padding: 6px 12px;\r\n    background: #2a2a4e;\r\n    border: 1px solid #3a3a5e;\r\n    color: #e0e0e0;\r\n    border-radius: 16px;\r\n    cursor: pointer;\r\n    font-size: 12px;\r\n    transition: all 0.2s;\r\n    font-family: inherit;\r\n  }\r\n\r\n  .timeline-chip:hover {\r\n    background: #3a3a5e;\r\n    border-color: #E93D82;\r\n  }\r\n\r\n  .timeline-chip.active {\r\n    background: #E93D82;\r\n    border-color: #E93D82;\r\n    color: white;\r\n  }\r\n\r\n  .audio-player-container {\r\n    margin-top: 8px;\r\n  }\r\n\r\n  .audio-player {\r\n    width: 100%;\r\n    height: 36px;\r\n    border-radius: 4px;\r\n    outline: none;\r\n  }\r\n\r\n  .audio-player::-webkit-media-controls-panel {\r\n    background: #2a2a4e;\r\n  }\r\n\r\n  .no-audio-message {\r\n    color: #555;\r\n    font-size: 12px;\r\n    font-style: italic;\r\n    text-align: center;\r\n    padding: 8px;\r\n  }\r\n\r\n  /* Animations */\r\n  @keyframes pulse {\r\n    0%, 100% { opacity: 1; }\r\n    50% { opacity: 0.5; }\r\n  }\r\n\r\n  .training-active .status-text {\r\n    animation: pulse 2s ease-in-out infinite;\r\n  }\r\n`\r\n\r\nexport function injectStyles(): void {\r\n  // Prevent duplicate injection\r\n  if (document.getElementById('qwen3-training-widget-styles')) {\r\n    return\r\n  }\r\n\r\n  const style = document.createElement('style')\r\n  style.id = 'qwen3-training-widget-styles'\r\n  style.textContent = TRAINING_WIDGET_STYLES\r\n  document.head.appendChild(style)\r\n}\r\n","import type { TrainingWidgetOptions, ValidationSample } from './types'\r\nimport { injectStyles } from './styles'\r\n\r\nexport class TrainingWidget {\r\n  private container: HTMLElement\r\n  private progressFill!: HTMLElement\r\n  private progressText!: HTMLElement\r\n  private statusText!: HTMLElement\r\n  private epochSpan!: HTMLElement\r\n  private lossSpan!: HTMLElement\r\n  private stopButton!: HTMLButtonElement\r\n  private timeline!: HTMLElement\r\n  private audioPlayer!: HTMLAudioElement\r\n  private audioPlayerContainer!: HTMLElement\r\n  private widgetRoot!: HTMLElement\r\n  private samples: ValidationSample[] = []\r\n  private activeChip: HTMLElement | null = null\r\n\r\n  constructor(options: TrainingWidgetOptions) {\r\n    injectStyles()\r\n    this.container = options.container\r\n    this.createDOM()\r\n    this.bindEvents()\r\n  }\r\n\r\n  private createDOM(): void {\r\n    this.container.innerHTML = `\r\n      <div class=\"qwen3-training-widget\">\r\n        <div class=\"training-header\">\r\n          <div class=\"status-panel\">\r\n            <div class=\"epoch-display\">Epoch: <span>0/0</span></div>\r\n            <div class=\"loss-display\">Loss: <span>--</span></div>\r\n            <div class=\"status-text\">Ready to train</div>\r\n          </div>\r\n          <button class=\"stop-btn\" disabled>Stop</button>\r\n        </div>\r\n\r\n        <div class=\"progress-container\">\r\n          <div class=\"progress-bar\">\r\n            <div class=\"progress-fill\" style=\"width: 0%\"></div>\r\n          </div>\r\n          <div class=\"progress-text\">0%</div>\r\n        </div>\r\n\r\n        <div class=\"validation-section\">\r\n          <div class=\"section-title\">Validation Samples</div>\r\n          <div class=\"audio-timeline\"></div>\r\n          <div class=\"audio-player-container\">\r\n            <audio class=\"audio-player\" controls style=\"display: none;\"></audio>\r\n            <div class=\"no-audio-message\">Click a sample to play</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `\r\n\r\n    // Cache element references\r\n    this.widgetRoot = this.container.querySelector('.qwen3-training-widget') as HTMLElement\r\n    this.progressFill = this.container.querySelector('.progress-fill') as HTMLElement\r\n    this.progressText = this.container.querySelector('.progress-text') as HTMLElement\r\n    this.statusText = this.container.querySelector('.status-text') as HTMLElement\r\n    this.epochSpan = this.container.querySelector('.epoch-display span') as HTMLElement\r\n    this.lossSpan = this.container.querySelector('.loss-display span') as HTMLElement\r\n    this.stopButton = this.container.querySelector('.stop-btn') as HTMLButtonElement\r\n    this.timeline = this.container.querySelector('.audio-timeline') as HTMLElement\r\n    this.audioPlayer = this.container.querySelector('.audio-player') as HTMLAudioElement\r\n    this.audioPlayerContainer = this.container.querySelector('.audio-player-container') as HTMLElement\r\n  }\r\n\r\n  private bindEvents(): void {\r\n    this.stopButton.addEventListener('click', () => {\r\n      this.requestStop()\r\n    })\r\n\r\n    this.audioPlayer.addEventListener('ended', () => {\r\n      // Optionally deselect chip when audio ends\r\n    })\r\n  }\r\n\r\n  private requestStop(): void {\r\n    // The stop functionality is handled by ComfyUI's interrupt mechanism\r\n    // This button is mainly visual - the actual stop happens via ComfyUI's cancel\r\n    this.statusText.textContent = 'Stopping...'\r\n    this.stopButton.disabled = true\r\n  }\r\n\r\n  public updateProgress(\r\n    epoch: number,\r\n    totalEpochs: number,\r\n    loss: number,\r\n    step: number,\r\n    totalSteps: number\r\n  ): void {\r\n    const overallProgress = ((epoch - 1 + step / totalSteps) / totalEpochs) * 100\r\n    this.progressFill.style.width = `${Math.min(overallProgress, 100)}%`\r\n    this.progressText.textContent = `${Math.round(overallProgress)}%`\r\n    this.epochSpan.textContent = `${epoch}/${totalEpochs}`\r\n    this.lossSpan.textContent = loss.toFixed(4)\r\n    this.statusText.textContent = `Training epoch ${epoch}, step ${step}/${totalSteps}...`\r\n    this.stopButton.disabled = false\r\n    this.widgetRoot.classList.add('training-active')\r\n  }\r\n\r\n  public addValidationSample(epoch: number, audioBase64: string, checkpointPath: string): void {\r\n    const sample: ValidationSample = { epoch, audioBase64, checkpointPath }\r\n    this.samples.push(sample)\r\n\r\n    // Create timeline chip\r\n    const chip = document.createElement('button')\r\n    chip.className = 'timeline-chip'\r\n    chip.textContent = `Ep ${epoch}`\r\n    chip.title = `Checkpoint: ${checkpointPath}`\r\n    chip.addEventListener('click', () => this.playSample(sample, chip))\r\n    this.timeline.appendChild(chip)\r\n\r\n    // Auto-play the new sample\r\n    this.playSample(sample, chip)\r\n  }\r\n\r\n  private playSample(sample: ValidationSample, chip: HTMLElement): void {\r\n    // Update active state\r\n    if (this.activeChip) {\r\n      this.activeChip.classList.remove('active')\r\n    }\r\n    chip.classList.add('active')\r\n    this.activeChip = chip\r\n\r\n    // Show and play audio\r\n    const noAudioMessage = this.audioPlayerContainer.querySelector('.no-audio-message') as HTMLElement\r\n    if (noAudioMessage) {\r\n      noAudioMessage.style.display = 'none'\r\n    }\r\n    this.audioPlayer.style.display = 'block'\r\n    this.audioPlayer.src = sample.audioBase64\r\n    this.audioPlayer.play().catch(e => {\r\n      console.warn('Audio autoplay prevented:', e)\r\n    })\r\n  }\r\n\r\n  public updateStatus(message: string): void {\r\n    this.statusText.textContent = message\r\n\r\n    // Check if training is complete\r\n    if (message.toLowerCase().includes('complete') || message.toLowerCase().includes('stopped')) {\r\n      this.widgetRoot.classList.remove('training-active')\r\n      this.stopButton.disabled = true\r\n      this.progressFill.style.width = '100%'\r\n      this.progressText.textContent = '100%'\r\n    }\r\n  }\r\n\r\n  public onTrainingComplete(checkpointPath: string | undefined): void {\r\n    if (checkpointPath) {\r\n      this.statusText.textContent = `Complete! Saved to: ${checkpointPath}`\r\n    } else {\r\n      this.statusText.textContent = 'Training complete!'\r\n    }\r\n    this.widgetRoot.classList.remove('training-active')\r\n    this.stopButton.disabled = true\r\n  }\r\n\r\n  public reset(): void {\r\n    this.samples = []\r\n    this.activeChip = null\r\n    this.timeline.innerHTML = ''\r\n    this.audioPlayer.style.display = 'none'\r\n    this.audioPlayer.src = ''\r\n    const noAudioMessage = this.audioPlayerContainer.querySelector('.no-audio-message') as HTMLElement\r\n    if (noAudioMessage) {\r\n      noAudioMessage.style.display = 'block'\r\n    }\r\n    this.progressFill.style.width = '0%'\r\n    this.progressText.textContent = '0%'\r\n    this.epochSpan.textContent = '0/0'\r\n    this.lossSpan.textContent = '--'\r\n    this.statusText.textContent = 'Ready to train'\r\n    this.stopButton.disabled = true\r\n    this.widgetRoot.classList.remove('training-active')\r\n  }\r\n\r\n  public dispose(): void {\r\n    this.audioPlayer.pause()\r\n    this.audioPlayer.src = ''\r\n    this.container.innerHTML = ''\r\n  }\r\n}\r\n","import { app } from '../../../scripts/app.js'\r\nimport { api } from '../../../scripts/api.js'\r\nimport { TrainingWidget } from './TrainingWidget'\r\nimport type { TrainingNode, DOMWidget, TrainingUpdateEvent } from './types'\r\n\r\n// Store widget instances for cleanup and updates\r\nconst widgetInstances = new Map<number, TrainingWidget>()\r\n\r\nfunction createTrainingWidget(node: TrainingNode): { widget: DOMWidget } {\r\n  // Create container element\r\n  const container = document.createElement('div')\r\n  container.id = `qwen3-training-widget-${node.id}`\r\n  container.style.width = '100%'\r\n  container.style.height = '100%'\r\n  container.style.minHeight = '280px'\r\n\r\n  // Create DOM widget using ComfyUI's API\r\n  const widget = node.addDOMWidget(\r\n    'training_ui',\r\n    'training-widget',\r\n    container,\r\n    {\r\n      getMinHeight: () => 300,\r\n      hideOnZoom: false,\r\n      serialize: false\r\n    }\r\n  ) as DOMWidget\r\n\r\n  // Create the actual widget after container is mounted\r\n  setTimeout(() => {\r\n    const trainingWidget = new TrainingWidget({\r\n      node,\r\n      container\r\n    })\r\n    widgetInstances.set(node.id, trainingWidget)\r\n  }, 100)\r\n\r\n  // Cleanup when node is removed\r\n  widget.onRemove = () => {\r\n    const instance = widgetInstances.get(node.id)\r\n    if (instance) {\r\n      instance.dispose()\r\n      widgetInstances.delete(node.id)\r\n    }\r\n  }\r\n\r\n  return { widget }\r\n}\r\n\r\n// Register the extension with ComfyUI\r\napp.registerExtension({\r\n  name: 'ComfyUI.FL_Qwen3TTS_TrainingUI',\r\n\r\n  // Called when any node is created\r\n  nodeCreated(node: TrainingNode) {\r\n    // Only handle our specific node type\r\n    if (node.constructor?.comfyClass !== 'FL_Qwen3TTS_TrainingUI') {\r\n      return\r\n    }\r\n\r\n    // Adjust default node size to accommodate the widget\r\n    const [oldWidth, oldHeight] = node.size\r\n    node.setSize([Math.max(oldWidth, 380), Math.max(oldHeight, 550)])\r\n\r\n    // Create the training widget\r\n    createTrainingWidget(node)\r\n  }\r\n})\r\n\r\n// Listen for custom training updates from Python\r\napi.addEventListener('qwen3tts_training_update', ((event: CustomEvent<TrainingUpdateEvent>) => {\r\n  const detail = event.detail\r\n  if (!detail?.node) return\r\n\r\n  const nodeId = parseInt(detail.node, 10)\r\n  const widget = widgetInstances.get(nodeId)\r\n  if (!widget) return\r\n\r\n  switch (detail.type) {\r\n    case 'progress':\r\n      widget.updateProgress(\r\n        detail.epoch as number,\r\n        detail.total_epochs as number,\r\n        detail.loss as number,\r\n        detail.step as number,\r\n        detail.total_steps as number\r\n      )\r\n      break\r\n\r\n    case 'validation':\r\n      widget.addValidationSample(\r\n        detail.epoch as number,\r\n        detail.audio_base64 as string,\r\n        detail.checkpoint_path as string\r\n      )\r\n      break\r\n\r\n    case 'status':\r\n      widget.updateStatus(detail.message as string)\r\n      break\r\n  }\r\n}) as EventListener)\r\n\r\n// Listen for node execution results (data from Python's \"ui\" dict)\r\napi.addEventListener('executed', ((event: CustomEvent) => {\r\n  const detail = event.detail\r\n  if (!detail?.node || !detail?.output) return\r\n\r\n  const nodeId = parseInt(detail.node, 10)\r\n  const widget = widgetInstances.get(nodeId)\r\n  if (!widget) return\r\n\r\n  // Access the ui data sent from Python\r\n  const checkpointPath = detail.output?.checkpoint_path as string[] | undefined\r\n\r\n  if (checkpointPath && checkpointPath.length > 0) {\r\n    widget.onTrainingComplete(checkpointPath[0])\r\n  }\r\n}) as EventListener)\r\n\r\n// Listen for execution start to reset the widget\r\napi.addEventListener('executing', ((event: CustomEvent) => {\r\n  const detail = event.detail\r\n  if (!detail?.node) return\r\n\r\n  const nodeId = parseInt(detail.node, 10)\r\n  const widget = widgetInstances.get(nodeId)\r\n  if (widget) {\r\n    widget.reset()\r\n  }\r\n}) as EventListener)\r\n\r\nexport { TrainingWidget }\r\n"],"names":[],"mappings":"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"}